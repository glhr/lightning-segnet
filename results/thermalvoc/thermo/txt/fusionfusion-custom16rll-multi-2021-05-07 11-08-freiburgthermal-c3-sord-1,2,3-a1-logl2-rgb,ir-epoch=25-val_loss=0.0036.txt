[W Context.cpp:69] Warning: torch.set_deterministic is in beta, and its design and  functionality may change in the future. (function operator())
[WARNING] Testing phase
Global seed set to 2
[WARNING] params "augment":               False
"bottleneck":            16
"bs":                    1
"dataset":               thermalvoc
"dataset_combo":         None
"dataset_combo_ntrain":  100
"dataset_seq":           None
"debug":                 False
"decoders":              multi
"depthwise_conv":        False
"dist":                  l1
"dist_alpha":            1
"fusion":                custom
"fusion_activ":          softmax
"gpus":                  1
"init":                  False
"init_channels":         None
"late_dilation":         1
"loss":                  None
"loss_weight":           True
"lr":                    None
"max_epochs":            1000
"modalities":            ['rgb', 'ir']
"mode":                  affordances
"momentum":              None
"nopredict":             False
"num_classes":           3
"optim":                 None
"orig_dataset":          None
"prefix":                None
"pretrained_last_layer": False
"ranks":                 1,2,3
"save":                  True
"save_xp":               thermo
"test_checkpoint":       lightning_logs/fusionfusion-custom16rll-multi-2021-05-07 11-08-freiburgthermal-c3-sord-1,2,3-a1-logl2-rgb,ir-epoch=25-val_loss=0.0036.ckpt
"test_samples":          None
"test_set":              full
"train":                 False
"train_checkpoint":      None
"update_output_layer":   False
"viz":                   False
"wd":                    0
"workers":               0
GPU available: True, used: True
TPU available: None, using: 0 TPU cores
[INFO] ['rgb', 'ir']
[WARNING] Testing phase
Global seed set to 2
[WARNING] params "augment":               False
"bottleneck":            16
"bs":                    1
"dataset":               thermalvoc
"dataset_combo":         None
"dataset_combo_ntrain":  100
"dataset_seq":           None
"debug":                 False
"decoders":              multi
"depthwise_conv":        False
"dist":                  l1
"dist_alpha":            1
"fusion":                custom
"fusion_activ":          softmax
"gpus":                  1
"init":                  False
"init_channels":         None
"late_dilation":         1
"loss":                  None
"loss_weight":           True
"lr":                    None
"max_epochs":            1000
"modalities":            ['rgb', 'ir']
"mode":                  affordances
"momentum":              None
"nopredict":             False
"num_classes":           3
"optim":                 None
"orig_dataset":          None
"prefix":                None
"pretrained_last_layer": False
"ranks":                 1,2,3
"save":                  True
"save_xp":               thermo
"test_checkpoint":       lightning_logs/fusionfusion-custom16rll-multi-2021-05-07 11-08-freiburgthermal-c3-sord-1,2,3-a1-logl2-rgb,ir-epoch=25-val_loss=0.0036.ckpt
"test_samples":          None
"test_set":              full
"train":                 False
"train_checkpoint":      None
"update_output_layer":   False
"viz":                   False
"wd":                    0
"workers":               0
[INFO] Save True
[INFO] Loading full set
[INFO] ['rgb', 'ir']
[INFO] None
[WARNING] dataset modalities ['rgb', 'ir'], depth completion True
[INFO] Loading train set
[INFO] ['rgb', 'ir']
[INFO] None
[WARNING] dataset modalities ['rgb', 'ir'], depth completion True
[INFO] Loading full set
[INFO] ['rgb', 'ir']
[INFO] None
[WARNING] dataset modalities ['rgb', 'ir'], depth completion True
[INFO] Loading val set
[INFO] ['rgb', 'ir']
[INFO] None
[WARNING] dataset modalities ['rgb', 'ir'], depth completion True
[WARNING] thermalvoc - train 1173 | val 147 | test 1466
[INFO] SORD ranks: [1, 2, 3]
[INFO] SORD alpha 1
[INFO] SORD ranks: [1, 2, 3]
[INFO] SORD alpha 1
/usr/local/lib/python3.8/dist-packages/torch/nn/_reduction.py:44: UserWarning: size_average and reduce args will be deprecated, please use reduction='none' instead.
  warnings.warn(warning.format(ret))
[INFO] Distance ranks [1, 2, 3]
[INFO] Distances: mistakes from 1 to 2
[INFO] IoU labels: [0, 1, 2]
[INFO] Confusion matrix labels: [0, 1, 2]
[INFO] IoU labels: [0, 1, 2]
[INFO] 2021-05-12 22-47-thermalvoc-c3-None-lw-rgb,ir
[INFO] fusion-custom16rll-multi-2021-05-12 22-47-thermalvoc-c3-None-lw-rgb,ir
Global seed set to 2
[WARNING] params "augment":               False
"bottleneck":            16
"bs":                    1
"dataset":               thermalvoc
"dataset_combo":         None
"dataset_combo_ntrain":  100
"dataset_seq":           None
"debug":                 False
"decoders":              multi
"depthwise_conv":        False
"dist":                  l1
"dist_alpha":            1
"fusion":                custom
"fusion_activ":          softmax
"gpus":                  1
"init":                  False
"init_channels":         None
"late_dilation":         1
"loss":                  None
"loss_weight":           True
"lr":                    None
"max_epochs":            1000
"modalities":            ['rgb', 'ir']
"mode":                  affordances
"momentum":              None
"nopredict":             False
"num_classes":           3
"optim":                 None
"orig_dataset":          None
"prefix":                None
"pretrained_last_layer": False
"ranks":                 1,2,3
"save":                  True
"save_xp":               thermo
"test_checkpoint":       lightning_logs/fusionfusion-custom16rll-multi-2021-05-07 11-08-freiburgthermal-c3-sord-1,2,3-a1-logl2-rgb,ir-epoch=25-val_loss=0.0036.ckpt
"test_samples":          None
"test_set":              full
"train":                 False
"train_checkpoint":      None
"update_output_layer":   False
"viz":                   False
"wd":                    0
"workers":               0
[INFO] Save True
[INFO] Loading full set
[INFO] ['rgb', 'ir']
[INFO] None
[WARNING] dataset modalities ['rgb', 'ir'], depth completion True
[INFO] Loading train set
[INFO] ['rgb', 'ir']
[INFO] None
[WARNING] dataset modalities ['rgb', 'ir'], depth completion True
[INFO] Loading full set
[INFO] ['rgb', 'ir']
[INFO] None
[WARNING] dataset modalities ['rgb', 'ir'], depth completion True
[INFO] Loading val set
[INFO] ['rgb', 'ir']
[INFO] None
[WARNING] dataset modalities ['rgb', 'ir'], depth completion True
[WARNING] thermalvoc - train 1173 | val 147 | test 1466
[INFO] SORD ranks: [1, 2, 3]
[INFO] SORD alpha 1
[INFO] SORD ranks: [1, 2, 3]
[INFO] SORD alpha 1
[INFO] Distance ranks [1, 2, 3]
[INFO] Distances: mistakes from 1 to 2
[INFO] IoU labels: [0, 1, 2]
[INFO] Confusion matrix labels: [0, 1, 2]
[INFO] IoU labels: [0, 1, 2]
[INFO] 2021-05-12 22-47-thermalvoc-c3-None-lw-rgb,ir
[INFO] fusion-custom16rll-multi-2021-05-12 22-47-thermalvoc-c3-None-lw-rgb,ir
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
fusionfusion-custom16rll-multi-2021-05-07 11-08-freiburgthermal-c3-sord-1,2,3-a1-logl2-rgb,ir-epoch=25-val_loss=0.0036
Testing: 0it [00:00, ?it/s]Testing:   0%|          | 1/1466 [00:01<34:53,  1.43s/it]Testing:   0%|          | 2/1466 [00:02<30:10,  1.24s/it]Testing:   0%|          | 3/1466 [00:03<28:30,  1.17s/it]Testing:   0%|          | 4/1466 [00:04<28:26,  1.17s/it]Testing:   0%|          | 5/1466 [00:05<27:58,  1.15s/it]Testing:   0%|          | 6/1466 [00:06<27:18,  1.12s/it]Testing:   0%|          | 7/1466 [00:08<26:46,  1.10s/it]Testing:   1%|          | 8/1466 [00:09<26:30,  1.09s/it]Testing:   1%|          | 9/1466 [00:10<26:48,  1.10s/it]Testing:   1%|          | 10/1466 [00:11<27:21,  1.13s/it]Testing:   1%|          | 11/1466 [00:12<26:58,  1.11s/it]Testing:   1%|          | 12/1466 [00:13<27:15,  1.12s/it]Testing:   1%|          | 13/1466 [00:14<26:57,  1.11s/it]Testing:   1%|          | 14/1466 [00:15<26:45,  1.11s/it]Testing:   1%|          | 15/1466 [00:16<26:26,  1.09s/it]Testing:   1%|          | 16/1466 [00:18<26:37,  1.10s/it]Testing:   1%|          | 17/1466 [00:19<26:38,  1.10s/it]Testing:   1%|          | 18/1466 [00:20<27:00,  1.12s/it]Testing:   1%|▏         | 19/1466 [00:21<26:33,  1.10s/it]Testing:   1%|▏         | 20/1466 [00:22<26:52,  1.12s/it]Testing:   1%|▏         | 21/1466 [00:23<26:42,  1.11s/it]Testing:   2%|▏         | 22/1466 [00:24<26:40,  1.11s/it]Testing:   2%|▏         | 23/1466 [00:25<26:43,  1.11s/it]Testing:   2%|▏         | 24/1466 [00:26<26:25,  1.10s/it]Testing:   2%|▏         | 25/1466 [00:28<27:06,  1.13s/it]Testing:   2%|▏         | 26/1466 [00:29<26:59,  1.12s/it]Testing:   2%|▏         | 27/1466 [00:30<27:07,  1.13s/it]Testing:   2%|▏         | 28/1466 [00:31<27:13,  1.14s/it]Testing:   2%|▏         | 29/1466 [00:32<27:09,  1.13s/it]Testing:   2%|▏         | 30/1466 [00:33<26:39,  1.11s/it]Testing:   2%|▏         | 31/1466 [00:34<26:36,  1.11s/it]Testing:   2%|▏         | 32/1466 [00:35<26:22,  1.10s/it]Testing:   2%|▏         | 33/1466 [00:36<26:04,  1.09s/it]Testing:   2%|▏         | 34/1466 [00:38<26:07,  1.09s/it]Testing:   2%|▏         | 35/1466 [00:39<26:14,  1.10s/it]Testing:   2%|▏         | 36/1466 [00:40<26:19,  1.10s/it]Testing:   3%|▎         | 37/1466 [00:41<26:22,  1.11s/it]Testing:   3%|▎         | 38/1466 [00:42<26:09,  1.10s/it]Testing:   3%|▎         | 39/1466 [00:43<26:19,  1.11s/it]Testing:   3%|▎         | 40/1466 [00:44<26:15,  1.10s/it]Testing:   3%|▎         | 41/1466 [00:45<26:00,  1.10s/it]Testing:   3%|▎         | 42/1466 [00:46<26:40,  1.12s/it]Testing:   3%|▎         | 43/1466 [00:48<26:40,  1.12s/it]Testing:   3%|▎         | 44/1466 [00:49<26:38,  1.12s/it]Testing:   3%|▎         | 45/1466 [00:50<26:37,  1.12s/it]Testing:   3%|▎         | 46/1466 [00:51<26:30,  1.12s/it]Testing:   3%|▎         | 47/1466 [00:52<26:13,  1.11s/it]Testing:   3%|▎         | 48/1466 [00:53<26:05,  1.10s/it]Testing:   3%|▎         | 49/1466 [00:54<26:19,  1.11s/it]Testing:   3%|▎         | 50/1466 [00:55<26:04,  1.10s/it]Testing:   3%|▎         | 51/1466 [00:56<25:50,  1.10s/it]Testing:   4%|▎         | 52/1466 [00:57<25:34,  1.09s/it]/usr/local/lib/python3.8/dist-packages/pytorch_lightning/utilities/distributed.py:52: UserWarning: The dataloader, test dataloader 0, does not have many workers which may be a bottleneck. Consider increasing the value of the `num_workers` argument` (try 96 which is the number of cpus on this machine) in the `DataLoader` init to improve performance.
  warnings.warn(*args, **kwargs)
Traceback (most recent call last):
  File "fusion-test.py", line 147, in <module>
    trainer.test(fusionnet)
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/trainer/trainer.py", line 915, in test
    results = self.__test_given_model(model, test_dataloaders)
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/trainer/trainer.py", line 973, in __test_given_model
    results = self.fit(model)
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/trainer/trainer.py", line 499, in fit
    self.dispatch()
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/trainer/trainer.py", line 540, in dispatch
    self.accelerator.start_testing(self)
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/accelerators/accelerator.py", line 76, in start_testing
    self.training_type_plugin.start_testing(trainer)
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/plugins/training_type/training_type_plugin.py", line 118, in start_testing
    self._results = trainer.run_test()
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/trainer/trainer.py", line 786, in run_test
    eval_loop_results, _ = self.run_evaluation()
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/trainer/trainer.py", line 725, in run_evaluation
    output = self.evaluation_loop.evaluation_step(batch, batch_idx, dataloader_idx)
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/trainer/evaluation_loop.py", line 160, in evaluation_step
    output = self.trainer.accelerator.test_step(args)
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/accelerators/accelerator.py", line 195, in test_step
    return self.training_type_plugin.test_step(*args)
  File "/usr/local/lib/python3.8/dist-packages/pytorch_lightning/plugins/training_type/training_type_plugin.py", line 134, in test_step
    return self.lightning_module.test_step(*args, **kwargs)
  File "/user/student.aau.dk/ghumbl19/learning-driveability-heatmaps/models/pytorch-unet-segnet/lightning.py", line 391, in test_step
    weight_map = weight_from_target(target_orig)
  File "/user/student.aau.dk/ghumbl19/learning-driveability-heatmaps/models/pytorch-unet-segnet/metrics.py", line 190, in weight_from_target
    map = np.array(compute_distmap(target[i].detach().cpu().numpy())["combined_map"],dtype=np.float32)
  File "/user/student.aau.dk/ghumbl19/learning-driveability-heatmaps/models/pytorch-unet-segnet/metrics.py", line 241, in compute_distmap
    pow = 1-np.exp(-(distmap_linear[ix, iy])/(1+30*(1-depth_map[ix, iy]**2)**2))
KeyboardInterrupt
Exception ignored in: <function tqdm.__del__ at 0x7f4ce5bd35e0>
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/dist-packages/tqdm/std.py", line 1145, in __del__
  File "/usr/local/lib/python3.8/dist-packages/tqdm/std.py", line 1299, in close
  File "/usr/local/lib/python3.8/dist-packages/tqdm/std.py", line 1492, in display
  File "/usr/local/lib/python3.8/dist-packages/tqdm/std.py", line 1148, in __str__
  File "/usr/local/lib/python3.8/dist-packages/tqdm/std.py", line 1450, in format_dict
TypeError: cannot unpack non-iterable NoneType object
